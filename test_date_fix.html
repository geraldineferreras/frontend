<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Date Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>Date Fix Test</h1>
    <p>This page tests the date formatting fix to ensure due dates are saved correctly.</p>

    <div class="test-section">
        <h2>Test Date Formatting</h2>
        <p>Testing the new formatDueDate function with various date inputs:</p>
        
        <div id="test-results" class="result info"></div>
    </div>

    <script>
        // Helper function to format due date correctly in local timezone
        const formatDueDate = (dateString) => {
            if (!dateString) return null;
            
            // Parse the date string and ensure it's treated as local time
            const [datePart, timePart] = dateString.split('T');
            const [year, month, day] = datePart.split('-').map(Number);
            const [hours, minutes] = timePart ? timePart.split(':').map(Number) : [23, 59];
            
            // Create date in local timezone
            const localDate = new Date(year, month - 1, day, hours, minutes);
            
            // Format as YYYY-MM-DD HH:MM:SS in local timezone
            const yearStr = localDate.getFullYear();
            const monthStr = String(localDate.getMonth() + 1).padStart(2, '0');
            const dayStr = String(localDate.getDate()).padStart(2, '0');
            const hoursStr = String(localDate.getHours()).padStart(2, '0');
            const minutesStr = String(localDate.getMinutes()).padStart(2, '0');
            
            return `${yearStr}-${monthStr}-${dayStr} ${hoursStr}:${minutesStr}:00`;
        };

        // Test cases
        const testCases = [
            '2025-08-10T04:15',  // The problematic case from the screenshot
            '2025-08-10T23:59',  // End of day
            '2025-08-10',        // Date only (should default to 23:59)
            '2025-12-25T12:00',  // Christmas at noon
            '2025-02-14T18:30',  // Valentine's Day evening
        ];

        let results = 'Date Formatting Test Results:\n\n';

        testCases.forEach((testCase, index) => {
            const oldMethod = testCase ? new Date(testCase).toISOString().slice(0, 19).replace('T', ' ') : null;
            const newMethod = formatDueDate(testCase);
            
            results += `Test ${index + 1}: "${testCase}"\n`;
            results += `  Old method: ${oldMethod}\n`;
            results += `  New method: ${newMethod}\n`;
            results += `  Difference: ${oldMethod !== newMethod ? 'FIXED!' : 'Same'}\n\n`;
        });

        // Additional timezone test
        const timezoneTest = '2025-08-10T04:15';
        const oldResult = new Date(timezoneTest).toISOString().slice(0, 19).replace('T', ' ');
        const newResult = formatDueDate(timezoneTest);
        
        results += `Timezone Test:\n`;
        results += `  Input: ${timezoneTest}\n`;
        results += `  Old method (UTC): ${oldResult}\n`;
        results += `  New method (Local): ${newResult}\n`;
        results += `  Expected: 2025-08-10 04:15:00\n`;
        results += `  Status: ${newResult === '2025-08-10 04:15:00' ? '✅ PASSED' : '❌ FAILED'}\n\n`;

        // Display results
        const resultsElement = document.getElementById('test-results');
        resultsElement.textContent = results;
        resultsElement.className = 'result success';
    </script>
</body>
</html>
