{"ast":null,"code":"import _objectSpread from \"C:/Users/user6974g/Downloads/SCMS_NEW-main/SCMS_NEW/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport axios from 'axios';\nconst API_BASE = 'http://localhost/scms_new/index.php/api';\nclass ApiService {\n  // Helper method for making requests\n  async makeRequest(endpoint) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const url = \"\".concat(API_BASE).concat(endpoint);\n    const {\n      method = 'GET',\n      headers = {},\n      body\n    } = options;\n    const config = {\n      url,\n      method,\n      headers: _objectSpread({\n        'Content-Type': 'application/json'\n      }, headers)\n    };\n    if (body) {\n      config.data = JSON.parse(body);\n    }\n    try {\n      const response = await axios(config);\n      return response.data;\n    } catch (error) {\n      var _error$response, _error$response$data, _error$response2;\n      // Axios error handling\n      const message = ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || error.message || 'API Error';\n      console.error(\"API Error (\".concat(endpoint, \"):\"), message);\n      // Token/session expiration handling\n      if (message.toLowerCase().includes('token expired') || message.toLowerCase().includes('unauthorized') || ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.status) === 401) {\n        // Dispatch a custom event for session timeout\n        window.dispatchEvent(new CustomEvent('sessionTimeout'));\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        localStorage.removeItem('scms_logged_in_user');\n        // Do not redirect here; let the modal handle it\n        return;\n      }\n      throw new Error(message);\n    }\n  }\n\n  // Authentication methods\n  async login(email, password) {\n    return this.makeRequest('/auth/login', {\n      method: 'POST',\n      body: JSON.stringify({\n        email,\n        password\n      })\n    });\n  }\n  async register(userData) {\n    return this.makeRequest('/auth/register', {\n      method: 'POST',\n      body: JSON.stringify(userData)\n    });\n  }\n  async logout() {\n    const token = localStorage.getItem('token');\n    return this.makeRequest('/auth/logout', {\n      method: 'POST',\n      headers: {\n        'Authorization': \"Bearer \".concat(token)\n      }\n    });\n  }\n\n  // Authenticated requests\n  async getProfile() {\n    const token = localStorage.getItem('token');\n    return this.makeRequest('/user', {\n      method: 'GET',\n      headers: {\n        'Authorization': \"Bearer \".concat(token)\n      }\n    });\n  }\n  async updateProfile(userData) {\n    const token = localStorage.getItem('token');\n    return this.makeRequest('/user', {\n      method: 'PUT',\n      headers: {\n        'Authorization': \"Bearer \".concat(token)\n      },\n      body: JSON.stringify(userData)\n    });\n  }\n\n  // Admin methods\n  async getSections() {\n    const token = localStorage.getItem('token');\n    return this.makeRequest('/admin/sections', {\n      method: 'GET',\n      headers: {\n        'Authorization': \"Bearer \".concat(token)\n      }\n    });\n  }\n  async createSection(sectionData) {\n    const token = localStorage.getItem('token');\n    return this.makeRequest('/admin/sections', {\n      method: 'POST',\n      headers: {\n        'Authorization': \"Bearer \".concat(token)\n      },\n      body: JSON.stringify(sectionData)\n    });\n  }\n\n  // Fetch users by role\n  async getUsersByRole(role) {\n    const token = localStorage.getItem('token');\n    return this.makeRequest(\"/users?role=\".concat(role), {\n      method: 'GET',\n      headers: {\n        'Authorization': \"Bearer \".concat(token)\n      }\n    });\n  }\n}\nexport default new ApiService();","map":{"version":3,"names":["axios","API_BASE","ApiService","makeRequest","endpoint","options","arguments","length","undefined","url","concat","method","headers","body","config","_objectSpread","data","JSON","parse","response","error","_error$response","_error$response$data","_error$response2","message","console","toLowerCase","includes","status","window","dispatchEvent","CustomEvent","localStorage","removeItem","Error","login","email","password","stringify","register","userData","logout","token","getItem","getProfile","updateProfile","getSections","createSection","sectionData","getUsersByRole","role"],"sources":["C:/Users/user6974g/Downloads/SCMS_NEW-main/SCMS_NEW/src/services/api.js"],"sourcesContent":["import axios from 'axios';\n\nconst API_BASE = 'http://localhost/scms_new/index.php/api';\n\nclass ApiService {\n  // Helper method for making requests\n  async makeRequest(endpoint, options = {}) {\n    const url = `${API_BASE}${endpoint}`;\n    const { method = 'GET', headers = {}, body } = options;\n    const config = {\n      url,\n      method,\n      headers: {\n        'Content-Type': 'application/json',\n        ...headers,\n      },\n    };\n    if (body) {\n      config.data = JSON.parse(body);\n    }\n    try {\n      const response = await axios(config);\n      return response.data;\n    } catch (error) {\n      // Axios error handling\n      const message = error.response?.data?.message || error.message || 'API Error';\n      console.error(`API Error (${endpoint}):`, message);\n      // Token/session expiration handling\n      if (\n        message.toLowerCase().includes('token expired') ||\n        message.toLowerCase().includes('unauthorized') ||\n        error.response?.status === 401\n      ) {\n        // Dispatch a custom event for session timeout\n        window.dispatchEvent(new CustomEvent('sessionTimeout'));\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        localStorage.removeItem('scms_logged_in_user');\n        // Do not redirect here; let the modal handle it\n        return;\n      }\n      throw new Error(message);\n    }\n  }\n\n  // Authentication methods\n  async login(email, password) {\n    return this.makeRequest('/auth/login', {\n      method: 'POST',\n      body: JSON.stringify({ email, password }),\n    });\n  }\n\n  async register(userData) {\n    return this.makeRequest('/auth/register', {\n      method: 'POST',\n      body: JSON.stringify(userData),\n    });\n  }\n\n  async logout() {\n    const token = localStorage.getItem('token');\n    return this.makeRequest('/auth/logout', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${token}`,\n      },\n    });\n  }\n\n  // Authenticated requests\n  async getProfile() {\n    const token = localStorage.getItem('token');\n    return this.makeRequest('/user', {\n      method: 'GET',\n      headers: {\n        'Authorization': `Bearer ${token}`,\n      },\n    });\n  }\n\n  async updateProfile(userData) {\n    const token = localStorage.getItem('token');\n    return this.makeRequest('/user', {\n      method: 'PUT',\n      headers: {\n        'Authorization': `Bearer ${token}`,\n      },\n      body: JSON.stringify(userData),\n    });\n  }\n\n  // Admin methods\n  async getSections() {\n    const token = localStorage.getItem('token');\n    return this.makeRequest('/admin/sections', {\n      method: 'GET',\n      headers: {\n        'Authorization': `Bearer ${token}`,\n      },\n    });\n  }\n\n  async createSection(sectionData) {\n    const token = localStorage.getItem('token');\n    return this.makeRequest('/admin/sections', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${token}`,\n      },\n      body: JSON.stringify(sectionData),\n    });\n  }\n\n  // Fetch users by role\n  async getUsersByRole(role) {\n    const token = localStorage.getItem('token');\n    return this.makeRequest(`/users?role=${role}`, {\n      method: 'GET',\n      headers: {\n        'Authorization': `Bearer ${token}`,\n      },\n    });\n  }\n}\n\nexport default new ApiService(); "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}